{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://bootstralph.dev/schemas/prd.json",
  "title": "PRD Schema",
  "description": "Product Requirements Document schema for Ralph Loop",
  "type": "object",
  "required": ["name", "version", "description", "status", "userStories"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Project or feature name",
      "minLength": 1
    },
    "version": {
      "type": "string",
      "description": "PRD version (semver recommended)",
      "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
    },
    "description": {
      "type": "string",
      "description": "Brief description of the project/feature"
    },
    "status": {
      "type": "string",
      "enum": ["planning", "in_progress", "completed", "paused", "blocked"],
      "description": "Current status of the PRD"
    },
    "branchName": {
      "type": "string",
      "description": "Git branch name for this PRD's work",
      "pattern": "^[a-zA-Z0-9._/-]+$"
    },
    "mode": {
      "type": "string",
      "enum": ["feature", "backlog"],
      "description": "PRD mode: feature (one branch) or backlog (branch-per-story)"
    },
    "githubRepo": {
      "type": "string",
      "description": "GitHub repository in owner/repo format",
      "pattern": "^[a-zA-Z0-9._-]+/[a-zA-Z0-9._-]+$"
    },
    "reviewTasks": {
      "type": "array",
      "description": "Review tasks to validate before implementation",
      "items": {
        "type": "object",
        "required": ["id", "category", "task", "check", "status"],
        "properties": {
          "id": { "type": "string" },
          "category": { "type": "string" },
          "task": { "type": "string" },
          "check": { "type": "string" },
          "status": {
            "type": "string",
            "enum": ["pending", "in_progress", "completed", "failed", "blocked"]
          },
          "finding": { "type": "string" },
          "actionRequired": { "type": ["string", "null"] }
        }
      }
    },
    "userStories": {
      "type": "array",
      "description": "User stories to implement",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "title", "description", "acceptanceCriteria", "priority", "passes"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier (e.g., US-001, IMPL-001)"
          },
          "title": {
            "type": "string",
            "description": "Short descriptive title"
          },
          "description": {
            "type": "string",
            "description": "Detailed description of what needs to be done"
          },
          "acceptanceCriteria": {
            "type": "array",
            "description": "List of acceptance criteria that must be met",
            "items": { "type": "string" },
            "minItems": 1
          },
          "priority": {
            "type": "integer",
            "description": "Priority level (lower = higher priority)",
            "minimum": 1
          },
          "passes": {
            "type": "boolean",
            "description": "Whether this story has been completed"
          },
          "dependsOn": {
            "type": "array",
            "description": "IDs of stories that must be completed before this one",
            "items": { "type": "string" }
          },
          "notes": {
            "type": "string",
            "description": "Optional notes added during implementation"
          },
          "startedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when story was started"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when story was completed"
          },
          "githubIssue": {
            "type": "integer",
            "description": "Optional GitHub issue number"
          }
        }
      }
    },
    "plugins": {
      "type": "object",
      "description": "Recommended plugins/skills for this PRD",
      "properties": {
        "recommended": {
          "type": "array",
          "items": { "type": "string" }
        },
        "optional": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        },
        "createdBy": {
          "type": "string"
        },
        "completionPromise": {
          "type": "string",
          "description": "String output when PRD is complete (default: <promise>COMPLETE</promise>)"
        }
      }
    }
  }
}
