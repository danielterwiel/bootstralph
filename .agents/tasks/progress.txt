# Progress Log for bootstralph
# Started: 2026-01-17T21:48:21+01:00

## 2026-01-17 - impl-013: Implement Expo scaffolder wrapper

### Completed
- Created `src/scaffolders/expo.ts` with full Expo scaffolding support
- Wraps `create-expo-stack@latest` CLI with bootstralph-specific configurations
- Supports Expo Router and React Navigation for routing
- Supports Uniwind (with NativeWind fallback + migration), NativeWind, Tamagui, Unistyles, and StyleSheets for styling
- Integrates with mobile backends: Supabase (with AsyncStorage), Convex (convex-react-native), Firebase (@react-native-firebase)
- Auth support: Clerk (@clerk/clerk-expo), better-auth (@better-auth/expo), Supabase Auth
- E2E testing: Maestro (with flow setup) and Detox (with config and example tests)
- Deployment: EAS Build configuration generation
- Pre-commit hooks: Lefthook, Husky, prek support
- Linting/Formatting: oxlint, Biome, ESLint, oxfmt, Prettier
- Environment template generation with EXPO_PUBLIC_ prefix convention

### Technical Details
- Uses Jest preset for unit testing (jest-expo)
- Creates test setup with @testing-library/react-native
- Generates Maestro flows in `.maestro/` directory
- Generates Detox configuration in `.detoxrc.js`
- Supabase client uses AsyncStorage for session persistence
- Uniwind migration swaps nativewind for uniwind post-scaffold

### Type check: PASSED

## 2026-01-17 - impl-014: Implement React Native CLI scaffolder wrapper

### Completed
- Created `src/scaffolders/rn-cli.ts` with full React Native CLI scaffolding support
- Wraps `npx @react-native-community/cli init` with bootstralph-specific configurations
- Prerequisite checking: Detects Xcode (macOS) and Android SDK installation
- Displays prerequisite warning with option to switch to Expo if tools missing
- React Navigation setup: @react-navigation/native + @react-navigation/native-stack
- Creates navigation structure with RootNavigator and example HomeScreen
- Styling support: Uniwind, NativeWind, Tamagui, StyleSheets
- Integrates with mobile backends: Supabase (with AsyncStorage), Convex (convex-react-native), Firebase (@react-native-firebase)
- Auth support: Clerk, better-auth (@better-auth/react-native), Supabase Auth
- E2E testing: Maestro (with flow setup) and Detox (with config and example tests)
- Deployment: Fastlane configuration generation with iOS/Android lanes
- Pre-commit hooks: Lefthook, Husky, prek support
- Linting/Formatting: oxlint, Biome, ESLint, oxfmt, Prettier
- Environment template generation

### Technical Details
- Uses Jest preset for unit testing (react-native preset)
- Creates test setup with @testing-library/react-native
- Generates Maestro flows in `.maestro/` directory
- Generates Detox configuration in `.detoxrc.js` with project-specific paths
- Fastlane Fastfile with build_dev, build_prod, and beta lanes for iOS/Android
- Supabase client uses AsyncStorage for session persistence
- Uniwind setup includes tailwind.config.js and babel.config.js updates
- NativeWind v4 setup includes metro.config.js with withNativeWind wrapper
- Tamagui setup includes tamagui.config.ts and react-native-reanimated plugin

### Type check: PASSED

## 2026-01-17 - impl-015: Implement React Router v7 scaffolder wrapper

### Completed
- Created `src/scaffolders/react-router.ts` with full React Router v7 (Framework Mode) scaffolding support
- Wraps `npx create-react-router@latest` (successor to Remix v2) with bootstralph-specific configurations
- Uses Vite for bundling (built-in to React Router v7)
- Tailwind CSS setup with @tailwindcss/vite plugin and tailwind.config.ts
- shadcn/ui setup with components.json and cn() utility helper
- State management: Zustand, Jotai, TanStack Query support
- ORM support: Drizzle (edge-compatible with @libsql/client or @neondatabase/serverless), Prisma
- Backend integrations: Supabase (@supabase/ssr), Convex, Firebase
- Auth support: better-auth, Clerk (@clerk/react-router), Supabase Auth
- Testing: Vitest (unit) with vite-tsconfig-paths, Playwright (e2e)
- Pre-commit hooks: Lefthook (YAML config), Husky (with lint-staged ESM config)
- Linting: oxlint, Biome, ESLint support
- Formatting: oxfmt, Biome, Prettier support
- Environment template generation with VITE_ prefix convention

### Technical Details
- Uses `~/` alias convention for imports (React Router v7 standard)
- Generates Vitest config at project root with app/** test inclusion
- Playwright configured for port 5173 (Vite default)
- Drizzle schema stored in app/db/ directory
- Supabase client provides both browser and server client helpers for loaders/actions
- Convex provider created in app/providers/ directory
- Husky config creates ESM lint-staged.config.js (not .cjs) for ESM projects
- Lefthook config includes stage_fixed: true for auto-staging fixed files

### Type check: PASSED

## 2026-01-17 - impl-016: Implement Astro scaffolder wrapper

### Completed
- Created `src/scaffolders/astro.ts` with full Astro scaffolding support
- Wraps `npm create astro@latest` CLI with bootstralph-specific configurations
- Uses Vite for bundling (Astro's default)
- File-based routing (Astro's built-in routing system)
- Styling: Tailwind CSS (via `astro add tailwind`), vanilla CSS
- React islands support via `astro add react` for interactive components
- MDX support via `astro add mdx` for content-rich pages
- Deployment adapters: Vercel, Netlify, Cloudflare (via `astro add`)
- ORM support: Drizzle (edge-compatible with @libsql/client or @neondatabase/serverless), Prisma
- Backend integrations: Supabase, Convex (via React islands with ConvexProvider), Firebase
- Auth support: better-auth (native Astro integration with middleware), Clerk (@clerk/astro with server-side middleware), Supabase Auth
- Testing: Vitest (unit with Astro's getViteConfig helper), Playwright (e2e)
- Pre-commit hooks: Lefthook (YAML config), Husky (with lint-staged ESM config), prek
- Linting: oxlint, Biome, ESLint support
- Formatting: oxfmt, Biome, Prettier (with prettier-plugin-astro)
- Environment template generation with PUBLIC_ prefix convention (Astro standard)

### Technical Details
- Uses `--template basics --yes --no-git --typescript strict` for non-interactive scaffold
- Generates Vitest config using Astro's `getViteConfig` helper for proper integration
- Playwright configured for port 4321 (Astro default dev server port)
- Drizzle schema stored in src/db/ directory
- Convex setup creates ConvexProvider in src/components/ for use in React islands
- better-auth setup creates auth.ts in src/lib/ and API route at pages/api/auth/[...all].ts
- Clerk setup creates middleware.ts for server-side auth protection
- Content Collections support: generates config.ts with blog collection and example MDX post
- Supabase client uses `import.meta.env` for environment variables

### Type check: PASSED

## 2026-01-17 - impl-017: Implement Hono/Elysia API template

### Completed
- Created `src/scaffolders/api.ts` with full API scaffolding support for both Hono and Elysia
- Wraps `npm create hono@latest` and `bun create elysia` with bootstralph-specific configurations
- Framework choice: Hono (edge-first, multi-runtime) or Elysia (Bun-native, TypeScript-first)
- Hono template selection based on deployment target: cloudflare-workers, vercel, netlify, nodejs, bun
- ORM support: Drizzle (with edge-compatible drivers), Prisma (with adapter for Cloudflare)
- Auth support: better-auth with framework-specific handler setup (Hono routes, Elysia plugin)
- Testing: Vitest with framework-appropriate test examples (Hono request API, Elysia Eden client)
- Deployment: Cloudflare Workers, Vercel, Netlify, Fly.io, Railway, Render
- Pre-commit hooks: Lefthook (YAML config), Husky (with lint-staged ESM config)
- Linting: oxlint, Biome, ESLint support
- Formatting: oxfmt, Biome, Prettier support
- Environment template generation with deployment-specific variables

### Technical Details
- Hono scaffolding uses `npm create hono@latest` with template selection based on deployment
- Elysia scaffolding always uses `bun create elysia` (Bun-native framework)
- Drizzle setup: SQLite/D1 for Cloudflare, PostgreSQL via Neon for other deployments
- Prisma setup: Uses @prisma/adapter-libsql for Cloudflare edge compatibility
- better-auth integration: Creates auth config with database adapter + framework-specific handler
- Hono handler mounts better-auth at /api/auth/* routes
- Elysia handler creates plugin with prefix '/api/auth'
- Vitest configured for Node.js environment with coverage via v8 provider
- Cloudflare deployments include wrangler as dev dependency for local dev and deployment

### Type check: PASSED

## 2026-01-17 - impl-018: Implement create command orchestration

### Completed
- Created `src/commands/create.ts` with full wizard orchestration
- Orchestrates the complete flow: project type → framework → features → deployment → tooling → scaffold
- Preset support for quick project setup: saas, mobile, api, content, universal, fullstack
- Full wizard flow with proper cancellation handling at each step
- Configuration validation using `validateAllSelections` before scaffolding
- Confirmation prompt before starting scaffold process
- Framework-specific scaffolder dispatching (Next.js, TanStack Start, Expo, React Native CLI, React Router v7, Astro, Hono, Elysia)
- Options builder functions for each scaffolder to handle type conversions
- Configuration summary display before scaffolding
- Proper handling of optional properties for exactOptionalPropertyTypes
- Updated `src/index.ts` to use the new `handleCreate` function

### Preset Configurations
- **saas**: Next.js + Tailwind/shadcn + Drizzle + Supabase + better-auth + Vercel
- **mobile**: Expo + Uniwind + Supabase + Clerk + EAS Build + Expo Router
- **api**: Hono + Drizzle + better-auth + Cloudflare
- **content**: Astro + Tailwind + Drizzle + Supabase + Vercel
- **universal**: Expo + Tamagui + Supabase + Clerk + EAS Build
- **fullstack**: Next.js + Tailwind/shadcn + Drizzle + Supabase + better-auth + Vercel

### Technical Details
- Uses promptProjectType, promptFramework, promptFeatures, promptDeployment, promptTooling from prompts/
- Calls appropriate scaffolder based on framework selection
- Builds scaffold options conditionally to satisfy TypeScript's exactOptionalPropertyTypes
- Handles directory existence check with overwrite confirmation
- Displays warnings and next steps from scaffold result
- Exports PRESET_CONFIGS, runWizard, applyPreset, runScaffolder, displayConfigSummary

### Type check: PASSED

## 2026-01-17 - impl-019: Implement CLAUDE.md template generator

### Completed
- Created `src/ralph/claudemd.ts` with CLAUDE.md generation and file writing utilities
- Created `src/templates/CLAUDE.md.ts` with comprehensive template generator
- Template includes all project configuration sections:
  - Project overview (platform, framework, package manager)
  - Tech stack (styling, state, ORM, backend, auth, testing, tooling, deployment)
  - Development workflow (getting started, testing, code quality, database commands)
  - Coding standards (architecture patterns, styling, state management, database, auth)
  - Important files (configuration, environment)
  - Conventions (git, code style, testing)
  - Ralph loop notes (usage, best practices)

### Technical Details
- `generateClaudeMd(config)` generates full CLAUDE.md content based on ClaudeMdConfig
- `writeClaudeMd(options)` writes CLAUDE.md to project directory with overwrite control
- `generateClaudeMdContent(config)` generates content without writing (for preview/testing)
- `hasClaudeMd(projectPath)` checks if CLAUDE.md exists
- `readClaudeMd(projectPath)` reads existing CLAUDE.md content
- Framework-specific patterns for Next.js, TanStack Start, React Router v7, Astro, Expo, RN CLI, Hono, Elysia
- Styling-specific patterns for Tailwind/shadcn, NativeWind, Uniwind, Tamagui
- State management patterns for Zustand, TanStack Query, Jotai
- Database patterns for Drizzle and Prisma
- Auth patterns for better-auth, Clerk, Supabase Auth

### Type check: PASSED

## 2026-01-17 - impl-020: Implement skills installation via openskills

### Completed
- Created `src/ralph/skills.ts` with full skills installation via openskills CLI
- Uses `execa` to spawn openskills CLI commands (openskills has no programmatic API)
- Integrates with existing `SKILLS_MATRIX` from `src/compatibility/matrix.ts`

### Features
- `isOpenskillsInstalled()` - Check if openskills CLI is available
- `installOpenskills()` - Install openskills globally via npm
- `installSkills(options)` - Install all skills for a project configuration
- `installSingleSkill(projectPath, skillName, source)` - Install a single skill by name
- `getSkillsToInstall(config)` - Get list of skills based on SkillsConfig
- `getSkillsInfo(projectPath, config)` - Get skill info with installed status
- `listInstalledSkills(projectPath)` - List skills installed in a project
- `hasAgentsMd(projectPath)` - Check if AGENTS.md exists
- `readAgentsMd(projectPath)` - Read AGENTS.md content

### Technical Details
- Marketplace management: Auto-adds known marketplaces (anthropics/skills, vercel-labs/agent-skills, obra/superpowers, expo/skills)
- Source mapping: Converts skill sources to marketplace format (e.g., @jezweb/claude-skills → jezweb/claude-skills)
- Handles "already installed" responses gracefully
- Syncs AGENTS.md after skill installation via `openskills sync`
- Properly handles execa v9 output types (string | Uint8Array | unknown[])
- Respects exactOptionalPropertyTypes for SkillInfo interface

### Skills Matrix Integration
Based on SkillsConfig (framework, backend, orm, auth, styling), installs:
- **All projects**: planning-with-files, test-driven-development, systematic-debugging, verification-before-completion
- **Next.js**: react-best-practices, vercel-deploy-claimable, web-design-guidelines
- **TanStack Start/React Router**: react-best-practices, web-design-guidelines
- **Expo/RN CLI**: expo-app-design, expo-deployment, upgrading-expo
- **Supabase**: supabase-operations
- **Drizzle**: drizzle-orm-d1, drizzle, drizzle-migration
- **better-auth**: better-auth
- **Clerk**: clerk-pack
- **Tailwind**: tailwind-v4-shadcn

### Type check: PASSED

## 2026-01-17 - impl-021: Implement Lefthook configuration generator

### Completed
- Created `src/templates/lefthook.yml.ts` with comprehensive Lefthook YAML template generator
- Created `src/ralph/hooks.ts` with full git hooks configuration management

### Features - lefthook.yml.ts Template Generator
- `generateLefthookYml(config)` - Main generator function
- Framework-aware glob patterns (Astro support for .astro files, standard patterns for others)
- Linter support: oxlint (with --fix), Biome (check --write), ESLint (--fix)
- Formatter support: oxfmt, Biome (format --write), Prettier (with Astro plugin when needed)
- TypeScript type checking command
- Commitlint support for commit message validation
- `stage_fixed: true` for auto-staging fixed files
- Parallel execution enabled by default
- Smart Biome handling: skips separate format step when Biome handles both linting and formatting
- Framework-specific generators: generateNextjsLefthook, generateTanStackLefthook, generateReactRouterLefthook, generateAstroLefthook, generateExpoLefthook, generateRNCliLefthook, generateHonoLefthook, generateElysiaLefthook

### Features - hooks.ts Configuration Manager
- `writeHooksConfig(options)` - Write hooks configuration for any supported tool
- `hasHooksInstalled(projectPath, tool)` - Check if hooks are installed
- `getHooksConfigPath(projectPath, tool)` - Get config file path for a tool
- `readHooksConfig(projectPath, tool)` - Read existing hooks configuration
- Lefthook support: Generates lefthook.yml with lint/format/typecheck commands
- Husky support: Creates .husky directory, pre-commit hook, lint-staged.config.js (ESM format), optional commit-msg hook with commitlint.config.cjs
- prek support: Generates .pre-commit-config.yaml (pre-commit compatible format)
- Optional hook installation via `installHooks` option
- Proper error handling and overwrite control

### Technical Details
- Uses ESM format for lint-staged config (lint-staged.config.js with export default)
- Uses CommonJS for commitlint config (commitlint.config.cjs) for ESM project compatibility
- Husky pre-commit script sources husky.sh and runs npx lint-staged
- prek warning about npm usage for Node.js hook environments
- Manual steps returned for user guidance (lefthook install, husky install, prek install)

### Type check: PASSED

## 2026-01-17 - impl-022: Implement Claude Code hooks setup

### Completed
- Created `src/templates/.claude/settings.json.ts` with Claude Code settings template generator
- Created `src/ralph/settings.ts` with settings file writing and management utilities

### Features - settings.json.ts Template Generator
- `generateClaudeSettings(config)` - Main generator function for Claude Code settings
- `generateClaudeSettingsJson(config)` - Generate JSON string output
- `generateMinimalClaudeSettings(config)` - Generate settings without hooks
- `generateClaudeSettingsLocal()` - Generate settings.local.json template
- Permissions system with allow/deny patterns using Tool(pattern) syntax
- Framework-specific patterns for Next.js, TanStack Start, React Router v7, Astro, Expo, RN CLI, Hono, Elysia
- ORM-specific patterns for Drizzle and Prisma
- Backend-specific patterns for Supabase, Firebase, Convex
- Auth-specific patterns for Clerk, better-auth, Supabase Auth
- Common deny patterns for .env files, key files, secrets directories, cloud credentials, SSH keys
- PreToolUse hooks for reliable security enforcement (workaround for deny rule enforcement issues)

### Features - settings.ts Settings Manager
- `writeClaudeSettings(options)` - Write .claude/settings.json and optionally settings.local.json
- `hasClaudeSettings(projectPath)` - Check if settings exist
- `readClaudeSettings(projectPath)` - Read existing settings
- `getClaudeSettingsPath(projectPath)` - Get settings file path
- `getClaudeSettingsLocalPath(projectPath)` - Get local settings file path
- `generateClaudeSettingsContent(config)` - Generate content without writing
- `createClaudeSettingsConfig(options)` - Create config from common project options
- Automatic .gitignore update to exclude settings.local.json
- Overwrite control for existing settings

### Technical Details
- Settings file hierarchy: .claude/settings.local.json > .claude/settings.json > ~/.claude/settings.json
- PreToolUse hooks execute before tools and can block (exit 2) or allow (exit 0)
- Hook matchers: Read, Write, Edit, Bash with grep-based pattern matching
- Security warning included about permissions.deny not being reliably enforced (GitHub issues #6631, #6699, #4467)
- Sensitive file patterns include: .env*, *.key, *.pem, /secrets/, /.aws/, /.ssh/, service-account*.json
- Dangerous command patterns include: sudo, rm -rf, chmod 777, curl, wget, mysqldump, pg_dump

### Type check: PASSED

## 2026-01-17 - impl-023: Implement Docker sandbox configuration

### Completed
- Created `src/templates/docker-compose.yml.ts` with Docker configuration template generators
- Created `src/ralph/sandbox.ts` with sandbox configuration manager

### Features - docker-compose.yml.ts Template Generators
- `generateDockerComposeYml(config)` - Generate docker-compose.yml for custom container approach
- `generateDockerfile(config)` - Generate Dockerfile for Claude Code container (node:20 base)
- `generateEnvExample(config)` - Generate .env.example with API key placeholders
- `generateDevcontainerJson(config)` - Generate VS Code devcontainer.json
- `generateMinimalDevcontainerJson()` - Generate minimal devcontainer (features-only)
- `generateStartClaudeScript(config)` - Generate start-claude.sh for docker sandbox approach
- `generateFirewallScript()` - Generate firewall-setup.sh for domain whitelisting (iptables)
- `generateDockerignore()` - Generate .dockerignore for container builds

### Features - sandbox.ts Configuration Manager
- `detectDockerEnvironment()` - Auto-detect Docker environment (sandbox, devcontainer, compose, none)
- `writeSandboxConfig(options)` - Write sandbox configuration based on detected environment
- `writeAllSandboxConfigs(options)` - Write all three approaches (sandbox, devcontainer, compose)
- `hasSandboxConfig(projectPath)` - Check what Docker configs exist in a project
- `getRecommendedDockerSetup()` - Get recommended Docker setup with commands

### Environment Detection
- Checks for Docker installation (`docker --version`)
- Checks if Docker daemon is running (`docker info`)
- Checks for Docker Desktop sandbox feature (`docker sandbox --help`)
- Detects VS Code environment (TERM_PROGRAM or `code` command)
- Returns recommendations based on detected environment

### Docker Approaches Supported
1. **Docker Desktop Sandbox** (simplest): `docker sandbox run claude`
   - Uses `docker/sandbox-templates:claude-code` image
   - Automatic credential management
   - Generates: start-claude.sh script

2. **DevContainer** (VS Code): `.devcontainer/devcontainer.json`
   - Uses `ghcr.io/anthropics/devcontainer-features/claude-code:1` feature
   - Seamless VS Code integration
   - Generates: .devcontainer/devcontainer.json

3. **Custom Dockerfile** (CI/CD): `docker-compose.yml` + `Dockerfile`
   - Full control over container environment
   - Optional network filtering with iptables
   - Generates: docker-compose.yml, Dockerfile, .env.example, .dockerignore, firewall-setup.sh

### Security Features
- Network filtering capability via cap_add: NET_ADMIN
- Domain whitelisting script (api.anthropic.com, registry.npmjs.org, github.com)
- .env file exclusion from git
- API keys via environment variables, never hardcoded

### Type check: PASSED

## 2026-01-17 - impl-024: Implement Ralph setup orchestration

### Completed
- Created `src/ralph/setup.ts` with full Ralph setup orchestration
- Orchestrates all Ralph components: CLAUDE.md, skills, hooks, settings, Docker sandbox
- Main function `setupRalph(options)` runs the complete setup process
- Interactive variant `setupRalphInteractive(options)` shows progress spinners for each step

### Features
- `setupRalph(options)` - Main entry point with configurable skip options
- `setupRalphInteractive(options)` - Interactive version with @clack/prompts spinners
- `setupRalphQuick(projectPath, projectName, framework)` - Minimal setup with sensible defaults
- `addRalphToExistingProject(projectPath)` - Placeholder for adding Ralph to existing projects

### Setup Steps (in order)
1. **CLAUDE.md** - Project-specific guidance for Claude Code
2. **Skills** - Install relevant skills via openskills CLI
3. **Git Hooks** - Configure pre-commit hooks (Lefthook/Husky/prek)
4. **Claude Settings** - Generate .claude/settings.json with permissions and hooks
5. **Docker Sandbox** - Configure Docker environment (sandbox/devcontainer/compose)

### Configuration Options
- `skipSkills` - Skip skills installation
- `skipDocker` - Skip Docker configuration
- `skipHooks` - Skip git hooks setup
- `skipSettings` - Skip Claude Code settings
- `skipClaudeMd` - Skip CLAUDE.md generation
- `installHooks` - Install hooks after generating config
- `overwrite` - Overwrite existing files
- `verbose` - Enable verbose output
- `dockerEnvironment` - Specify Docker environment (auto-detect if not provided)
- `allDockerConfigs` - Write all Docker configurations

### Result Tracking
- `filesWritten` - List of files created/modified
- `skillsInstalled` - List of successfully installed skills
- `skillsFailed` - List of skills that failed to install
- `warnings` - Any warnings during setup
- `errors` - Any errors during setup
- `nextSteps` - Suggested next steps for the user

### Re-exports
- Sub-module functions for direct access: writeClaudeMd, installSkills, writeHooksConfig, writeClaudeSettings, writeSandboxConfig, detectDockerEnvironment

### Type check: PASSED

