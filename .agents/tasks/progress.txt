# Progress Log for bootstralph
# Started: 2026-01-17T21:48:21+01:00

## 2026-01-17 - impl-013: Implement Expo scaffolder wrapper

### Completed
- Created `src/scaffolders/expo.ts` with full Expo scaffolding support
- Wraps `create-expo-stack@latest` CLI with bootstralph-specific configurations
- Supports Expo Router and React Navigation for routing
- Supports Uniwind (with NativeWind fallback + migration), NativeWind, Tamagui, Unistyles, and StyleSheets for styling
- Integrates with mobile backends: Supabase (with AsyncStorage), Convex (convex-react-native), Firebase (@react-native-firebase)
- Auth support: Clerk (@clerk/clerk-expo), better-auth (@better-auth/expo), Supabase Auth
- E2E testing: Maestro (with flow setup) and Detox (with config and example tests)
- Deployment: EAS Build configuration generation
- Pre-commit hooks: Lefthook, Husky, prek support
- Linting/Formatting: oxlint, Biome, ESLint, oxfmt, Prettier
- Environment template generation with EXPO_PUBLIC_ prefix convention

### Technical Details
- Uses Jest preset for unit testing (jest-expo)
- Creates test setup with @testing-library/react-native
- Generates Maestro flows in `.maestro/` directory
- Generates Detox configuration in `.detoxrc.js`
- Supabase client uses AsyncStorage for session persistence
- Uniwind migration swaps nativewind for uniwind post-scaffold

### Type check: PASSED

## 2026-01-17 - impl-014: Implement React Native CLI scaffolder wrapper

### Completed
- Created `src/scaffolders/rn-cli.ts` with full React Native CLI scaffolding support
- Wraps `npx @react-native-community/cli init` with bootstralph-specific configurations
- Prerequisite checking: Detects Xcode (macOS) and Android SDK installation
- Displays prerequisite warning with option to switch to Expo if tools missing
- React Navigation setup: @react-navigation/native + @react-navigation/native-stack
- Creates navigation structure with RootNavigator and example HomeScreen
- Styling support: Uniwind, NativeWind, Tamagui, StyleSheets
- Integrates with mobile backends: Supabase (with AsyncStorage), Convex (convex-react-native), Firebase (@react-native-firebase)
- Auth support: Clerk, better-auth (@better-auth/react-native), Supabase Auth
- E2E testing: Maestro (with flow setup) and Detox (with config and example tests)
- Deployment: Fastlane configuration generation with iOS/Android lanes
- Pre-commit hooks: Lefthook, Husky, prek support
- Linting/Formatting: oxlint, Biome, ESLint, oxfmt, Prettier
- Environment template generation

### Technical Details
- Uses Jest preset for unit testing (react-native preset)
- Creates test setup with @testing-library/react-native
- Generates Maestro flows in `.maestro/` directory
- Generates Detox configuration in `.detoxrc.js` with project-specific paths
- Fastlane Fastfile with build_dev, build_prod, and beta lanes for iOS/Android
- Supabase client uses AsyncStorage for session persistence
- Uniwind setup includes tailwind.config.js and babel.config.js updates
- NativeWind v4 setup includes metro.config.js with withNativeWind wrapper
- Tamagui setup includes tamagui.config.ts and react-native-reanimated plugin

### Type check: PASSED

## 2026-01-17 - impl-015: Implement React Router v7 scaffolder wrapper

### Completed
- Created `src/scaffolders/react-router.ts` with full React Router v7 (Framework Mode) scaffolding support
- Wraps `npx create-react-router@latest` (successor to Remix v2) with bootstralph-specific configurations
- Uses Vite for bundling (built-in to React Router v7)
- Tailwind CSS setup with @tailwindcss/vite plugin and tailwind.config.ts
- shadcn/ui setup with components.json and cn() utility helper
- State management: Zustand, Jotai, TanStack Query support
- ORM support: Drizzle (edge-compatible with @libsql/client or @neondatabase/serverless), Prisma
- Backend integrations: Supabase (@supabase/ssr), Convex, Firebase
- Auth support: better-auth, Clerk (@clerk/react-router), Supabase Auth
- Testing: Vitest (unit) with vite-tsconfig-paths, Playwright (e2e)
- Pre-commit hooks: Lefthook (YAML config), Husky (with lint-staged ESM config)
- Linting: oxlint, Biome, ESLint support
- Formatting: oxfmt, Biome, Prettier support
- Environment template generation with VITE_ prefix convention

### Technical Details
- Uses `~/` alias convention for imports (React Router v7 standard)
- Generates Vitest config at project root with app/** test inclusion
- Playwright configured for port 5173 (Vite default)
- Drizzle schema stored in app/db/ directory
- Supabase client provides both browser and server client helpers for loaders/actions
- Convex provider created in app/providers/ directory
- Husky config creates ESM lint-staged.config.js (not .cjs) for ESM projects
- Lefthook config includes stage_fixed: true for auto-staging fixed files

### Type check: PASSED

## 2026-01-17 - impl-016: Implement Astro scaffolder wrapper

### Completed
- Created `src/scaffolders/astro.ts` with full Astro scaffolding support
- Wraps `npm create astro@latest` CLI with bootstralph-specific configurations
- Uses Vite for bundling (Astro's default)
- File-based routing (Astro's built-in routing system)
- Styling: Tailwind CSS (via `astro add tailwind`), vanilla CSS
- React islands support via `astro add react` for interactive components
- MDX support via `astro add mdx` for content-rich pages
- Deployment adapters: Vercel, Netlify, Cloudflare (via `astro add`)
- ORM support: Drizzle (edge-compatible with @libsql/client or @neondatabase/serverless), Prisma
- Backend integrations: Supabase, Convex (via React islands with ConvexProvider), Firebase
- Auth support: better-auth (native Astro integration with middleware), Clerk (@clerk/astro with server-side middleware), Supabase Auth
- Testing: Vitest (unit with Astro's getViteConfig helper), Playwright (e2e)
- Pre-commit hooks: Lefthook (YAML config), Husky (with lint-staged ESM config), prek
- Linting: oxlint, Biome, ESLint support
- Formatting: oxfmt, Biome, Prettier (with prettier-plugin-astro)
- Environment template generation with PUBLIC_ prefix convention (Astro standard)

### Technical Details
- Uses `--template basics --yes --no-git --typescript strict` for non-interactive scaffold
- Generates Vitest config using Astro's `getViteConfig` helper for proper integration
- Playwright configured for port 4321 (Astro default dev server port)
- Drizzle schema stored in src/db/ directory
- Convex setup creates ConvexProvider in src/components/ for use in React islands
- better-auth setup creates auth.ts in src/lib/ and API route at pages/api/auth/[...all].ts
- Clerk setup creates middleware.ts for server-side auth protection
- Content Collections support: generates config.ts with blog collection and example MDX post
- Supabase client uses `import.meta.env` for environment variables

### Type check: PASSED

## 2026-01-17 - impl-017: Implement Hono/Elysia API template

### Completed
- Created `src/scaffolders/api.ts` with full API scaffolding support for both Hono and Elysia
- Wraps `npm create hono@latest` and `bun create elysia` with bootstralph-specific configurations
- Framework choice: Hono (edge-first, multi-runtime) or Elysia (Bun-native, TypeScript-first)
- Hono template selection based on deployment target: cloudflare-workers, vercel, netlify, nodejs, bun
- ORM support: Drizzle (with edge-compatible drivers), Prisma (with adapter for Cloudflare)
- Auth support: better-auth with framework-specific handler setup (Hono routes, Elysia plugin)
- Testing: Vitest with framework-appropriate test examples (Hono request API, Elysia Eden client)
- Deployment: Cloudflare Workers, Vercel, Netlify, Fly.io, Railway, Render
- Pre-commit hooks: Lefthook (YAML config), Husky (with lint-staged ESM config)
- Linting: oxlint, Biome, ESLint support
- Formatting: oxfmt, Biome, Prettier support
- Environment template generation with deployment-specific variables

### Technical Details
- Hono scaffolding uses `npm create hono@latest` with template selection based on deployment
- Elysia scaffolding always uses `bun create elysia` (Bun-native framework)
- Drizzle setup: SQLite/D1 for Cloudflare, PostgreSQL via Neon for other deployments
- Prisma setup: Uses @prisma/adapter-libsql for Cloudflare edge compatibility
- better-auth integration: Creates auth config with database adapter + framework-specific handler
- Hono handler mounts better-auth at /api/auth/* routes
- Elysia handler creates plugin with prefix '/api/auth'
- Vitest configured for Node.js environment with coverage via v8 provider
- Cloudflare deployments include wrangler as dev dependency for local dev and deployment

### Type check: PASSED

## 2026-01-17 - impl-018: Implement create command orchestration

### Completed
- Created `src/commands/create.ts` with full wizard orchestration
- Orchestrates the complete flow: project type → framework → features → deployment → tooling → scaffold
- Preset support for quick project setup: saas, mobile, api, content, universal, fullstack
- Full wizard flow with proper cancellation handling at each step
- Configuration validation using `validateAllSelections` before scaffolding
- Confirmation prompt before starting scaffold process
- Framework-specific scaffolder dispatching (Next.js, TanStack Start, Expo, React Native CLI, React Router v7, Astro, Hono, Elysia)
- Options builder functions for each scaffolder to handle type conversions
- Configuration summary display before scaffolding
- Proper handling of optional properties for exactOptionalPropertyTypes
- Updated `src/index.ts` to use the new `handleCreate` function

### Preset Configurations
- **saas**: Next.js + Tailwind/shadcn + Drizzle + Supabase + better-auth + Vercel
- **mobile**: Expo + Uniwind + Supabase + Clerk + EAS Build + Expo Router
- **api**: Hono + Drizzle + better-auth + Cloudflare
- **content**: Astro + Tailwind + Drizzle + Supabase + Vercel
- **universal**: Expo + Tamagui + Supabase + Clerk + EAS Build
- **fullstack**: Next.js + Tailwind/shadcn + Drizzle + Supabase + better-auth + Vercel

### Technical Details
- Uses promptProjectType, promptFramework, promptFeatures, promptDeployment, promptTooling from prompts/
- Calls appropriate scaffolder based on framework selection
- Builds scaffold options conditionally to satisfy TypeScript's exactOptionalPropertyTypes
- Handles directory existence check with overwrite confirmation
- Displays warnings and next steps from scaffold result
- Exports PRESET_CONFIGS, runWizard, applyPreset, runScaffolder, displayConfigSummary

### Type check: PASSED

## 2026-01-17 - impl-019: Implement CLAUDE.md template generator

### Completed
- Created `src/ralph/claudemd.ts` with CLAUDE.md generation and file writing utilities
- Created `src/templates/CLAUDE.md.ts` with comprehensive template generator
- Template includes all project configuration sections:
  - Project overview (platform, framework, package manager)
  - Tech stack (styling, state, ORM, backend, auth, testing, tooling, deployment)
  - Development workflow (getting started, testing, code quality, database commands)
  - Coding standards (architecture patterns, styling, state management, database, auth)
  - Important files (configuration, environment)
  - Conventions (git, code style, testing)
  - Ralph loop notes (usage, best practices)

### Technical Details
- `generateClaudeMd(config)` generates full CLAUDE.md content based on ClaudeMdConfig
- `writeClaudeMd(options)` writes CLAUDE.md to project directory with overwrite control
- `generateClaudeMdContent(config)` generates content without writing (for preview/testing)
- `hasClaudeMd(projectPath)` checks if CLAUDE.md exists
- `readClaudeMd(projectPath)` reads existing CLAUDE.md content
- Framework-specific patterns for Next.js, TanStack Start, React Router v7, Astro, Expo, RN CLI, Hono, Elysia
- Styling-specific patterns for Tailwind/shadcn, NativeWind, Uniwind, Tamagui
- State management patterns for Zustand, TanStack Query, Jotai
- Database patterns for Drizzle and Prisma
- Auth patterns for better-auth, Clerk, Supabase Auth

### Type check: PASSED

## 2026-01-17 - impl-020: Implement skills installation via openskills

### Completed
- Created `src/ralph/skills.ts` with full skills installation via openskills CLI
- Uses `execa` to spawn openskills CLI commands (openskills has no programmatic API)
- Integrates with existing `SKILLS_MATRIX` from `src/compatibility/matrix.ts`

### Features
- `isOpenskillsInstalled()` - Check if openskills CLI is available
- `installOpenskills()` - Install openskills globally via npm
- `installSkills(options)` - Install all skills for a project configuration
- `installSingleSkill(projectPath, skillName, source)` - Install a single skill by name
- `getSkillsToInstall(config)` - Get list of skills based on SkillsConfig
- `getSkillsInfo(projectPath, config)` - Get skill info with installed status
- `listInstalledSkills(projectPath)` - List skills installed in a project
- `hasAgentsMd(projectPath)` - Check if AGENTS.md exists
- `readAgentsMd(projectPath)` - Read AGENTS.md content

### Technical Details
- Marketplace management: Auto-adds known marketplaces (anthropics/skills, vercel-labs/agent-skills, obra/superpowers, expo/skills)
- Source mapping: Converts skill sources to marketplace format (e.g., @jezweb/claude-skills → jezweb/claude-skills)
- Handles "already installed" responses gracefully
- Syncs AGENTS.md after skill installation via `openskills sync`
- Properly handles execa v9 output types (string | Uint8Array | unknown[])
- Respects exactOptionalPropertyTypes for SkillInfo interface

### Skills Matrix Integration
Based on SkillsConfig (framework, backend, orm, auth, styling), installs:
- **All projects**: planning-with-files, test-driven-development, systematic-debugging, verification-before-completion
- **Next.js**: react-best-practices, vercel-deploy-claimable, web-design-guidelines
- **TanStack Start/React Router**: react-best-practices, web-design-guidelines
- **Expo/RN CLI**: expo-app-design, expo-deployment, upgrading-expo
- **Supabase**: supabase-operations
- **Drizzle**: drizzle-orm-d1, drizzle, drizzle-migration
- **better-auth**: better-auth
- **Clerk**: clerk-pack
- **Tailwind**: tailwind-v4-shadcn

### Type check: PASSED

## 2026-01-17 - impl-021: Implement Lefthook configuration generator

### Completed
- Created `src/templates/lefthook.yml.ts` with comprehensive Lefthook YAML template generator
- Created `src/ralph/hooks.ts` with full git hooks configuration management

### Features - lefthook.yml.ts Template Generator
- `generateLefthookYml(config)` - Main generator function
- Framework-aware glob patterns (Astro support for .astro files, standard patterns for others)
- Linter support: oxlint (with --fix), Biome (check --write), ESLint (--fix)
- Formatter support: oxfmt, Biome (format --write), Prettier (with Astro plugin when needed)
- TypeScript type checking command
- Commitlint support for commit message validation
- `stage_fixed: true` for auto-staging fixed files
- Parallel execution enabled by default
- Smart Biome handling: skips separate format step when Biome handles both linting and formatting
- Framework-specific generators: generateNextjsLefthook, generateTanStackLefthook, generateReactRouterLefthook, generateAstroLefthook, generateExpoLefthook, generateRNCliLefthook, generateHonoLefthook, generateElysiaLefthook

### Features - hooks.ts Configuration Manager
- `writeHooksConfig(options)` - Write hooks configuration for any supported tool
- `hasHooksInstalled(projectPath, tool)` - Check if hooks are installed
- `getHooksConfigPath(projectPath, tool)` - Get config file path for a tool
- `readHooksConfig(projectPath, tool)` - Read existing hooks configuration
- Lefthook support: Generates lefthook.yml with lint/format/typecheck commands
- Husky support: Creates .husky directory, pre-commit hook, lint-staged.config.js (ESM format), optional commit-msg hook with commitlint.config.cjs
- prek support: Generates .pre-commit-config.yaml (pre-commit compatible format)
- Optional hook installation via `installHooks` option
- Proper error handling and overwrite control

### Technical Details
- Uses ESM format for lint-staged config (lint-staged.config.js with export default)
- Uses CommonJS for commitlint config (commitlint.config.cjs) for ESM project compatibility
- Husky pre-commit script sources husky.sh and runs npx lint-staged
- prek warning about npm usage for Node.js hook environments
- Manual steps returned for user guidance (lefthook install, husky install, prek install)

### Type check: PASSED

## 2026-01-17 - impl-022: Implement Claude Code hooks setup

### Completed
- Created `src/templates/.claude/settings.json.ts` with Claude Code settings template generator
- Created `src/ralph/settings.ts` with settings file writing and management utilities

### Features - settings.json.ts Template Generator
- `generateClaudeSettings(config)` - Main generator function for Claude Code settings
- `generateClaudeSettingsJson(config)` - Generate JSON string output
- `generateMinimalClaudeSettings(config)` - Generate settings without hooks
- `generateClaudeSettingsLocal()` - Generate settings.local.json template
- Permissions system with allow/deny patterns using Tool(pattern) syntax
- Framework-specific patterns for Next.js, TanStack Start, React Router v7, Astro, Expo, RN CLI, Hono, Elysia
- ORM-specific patterns for Drizzle and Prisma
- Backend-specific patterns for Supabase, Firebase, Convex
- Auth-specific patterns for Clerk, better-auth, Supabase Auth
- Common deny patterns for .env files, key files, secrets directories, cloud credentials, SSH keys
- PreToolUse hooks for reliable security enforcement (workaround for deny rule enforcement issues)

### Features - settings.ts Settings Manager
- `writeClaudeSettings(options)` - Write .claude/settings.json and optionally settings.local.json
- `hasClaudeSettings(projectPath)` - Check if settings exist
- `readClaudeSettings(projectPath)` - Read existing settings
- `getClaudeSettingsPath(projectPath)` - Get settings file path
- `getClaudeSettingsLocalPath(projectPath)` - Get local settings file path
- `generateClaudeSettingsContent(config)` - Generate content without writing
- `createClaudeSettingsConfig(options)` - Create config from common project options
- Automatic .gitignore update to exclude settings.local.json
- Overwrite control for existing settings

### Technical Details
- Settings file hierarchy: .claude/settings.local.json > .claude/settings.json > ~/.claude/settings.json
- PreToolUse hooks execute before tools and can block (exit 2) or allow (exit 0)
- Hook matchers: Read, Write, Edit, Bash with grep-based pattern matching
- Security warning included about permissions.deny not being reliably enforced (GitHub issues #6631, #6699, #4467)
- Sensitive file patterns include: .env*, *.key, *.pem, /secrets/, /.aws/, /.ssh/, service-account*.json
- Dangerous command patterns include: sudo, rm -rf, chmod 777, curl, wget, mysqldump, pg_dump

### Type check: PASSED

## 2026-01-17 - impl-023: Implement Docker sandbox configuration

### Completed
- Created `src/templates/docker-compose.yml.ts` with Docker configuration template generators
- Created `src/ralph/sandbox.ts` with sandbox configuration manager

### Features - docker-compose.yml.ts Template Generators
- `generateDockerComposeYml(config)` - Generate docker-compose.yml for custom container approach
- `generateDockerfile(config)` - Generate Dockerfile for Claude Code container (node:20 base)
- `generateEnvExample(config)` - Generate .env.example with API key placeholders
- `generateDevcontainerJson(config)` - Generate VS Code devcontainer.json
- `generateMinimalDevcontainerJson()` - Generate minimal devcontainer (features-only)
- `generateStartClaudeScript(config)` - Generate start-claude.sh for docker sandbox approach
- `generateFirewallScript()` - Generate firewall-setup.sh for domain whitelisting (iptables)
- `generateDockerignore()` - Generate .dockerignore for container builds

### Features - sandbox.ts Configuration Manager
- `detectDockerEnvironment()` - Auto-detect Docker environment (sandbox, devcontainer, compose, none)
- `writeSandboxConfig(options)` - Write sandbox configuration based on detected environment
- `writeAllSandboxConfigs(options)` - Write all three approaches (sandbox, devcontainer, compose)
- `hasSandboxConfig(projectPath)` - Check what Docker configs exist in a project
- `getRecommendedDockerSetup()` - Get recommended Docker setup with commands

### Environment Detection
- Checks for Docker installation (`docker --version`)
- Checks if Docker daemon is running (`docker info`)
- Checks for Docker Desktop sandbox feature (`docker sandbox --help`)
- Detects VS Code environment (TERM_PROGRAM or `code` command)
- Returns recommendations based on detected environment

### Docker Approaches Supported
1. **Docker Desktop Sandbox** (simplest): `docker sandbox run claude`
   - Uses `docker/sandbox-templates:claude-code` image
   - Automatic credential management
   - Generates: start-claude.sh script

2. **DevContainer** (VS Code): `.devcontainer/devcontainer.json`
   - Uses `ghcr.io/anthropics/devcontainer-features/claude-code:1` feature
   - Seamless VS Code integration
   - Generates: .devcontainer/devcontainer.json

3. **Custom Dockerfile** (CI/CD): `docker-compose.yml` + `Dockerfile`
   - Full control over container environment
   - Optional network filtering with iptables
   - Generates: docker-compose.yml, Dockerfile, .env.example, .dockerignore, firewall-setup.sh

### Security Features
- Network filtering capability via cap_add: NET_ADMIN
- Domain whitelisting script (api.anthropic.com, registry.npmjs.org, github.com)
- .env file exclusion from git
- API keys via environment variables, never hardcoded

### Type check: PASSED

## 2026-01-17 - impl-024: Implement Ralph setup orchestration

### Completed
- Created `src/ralph/setup.ts` with full Ralph setup orchestration
- Orchestrates all Ralph components: CLAUDE.md, skills, hooks, settings, Docker sandbox
- Main function `setupRalph(options)` runs the complete setup process
- Interactive variant `setupRalphInteractive(options)` shows progress spinners for each step

### Features
- `setupRalph(options)` - Main entry point with configurable skip options
- `setupRalphInteractive(options)` - Interactive version with @clack/prompts spinners
- `setupRalphQuick(projectPath, projectName, framework)` - Minimal setup with sensible defaults
- `addRalphToExistingProject(projectPath)` - Placeholder for adding Ralph to existing projects

### Setup Steps (in order)
1. **CLAUDE.md** - Project-specific guidance for Claude Code
2. **Skills** - Install relevant skills via openskills CLI
3. **Git Hooks** - Configure pre-commit hooks (Lefthook/Husky/prek)
4. **Claude Settings** - Generate .claude/settings.json with permissions and hooks
5. **Docker Sandbox** - Configure Docker environment (sandbox/devcontainer/compose)

### Configuration Options
- `skipSkills` - Skip skills installation
- `skipDocker` - Skip Docker configuration
- `skipHooks` - Skip git hooks setup
- `skipSettings` - Skip Claude Code settings
- `skipClaudeMd` - Skip CLAUDE.md generation
- `installHooks` - Install hooks after generating config
- `overwrite` - Overwrite existing files
- `verbose` - Enable verbose output
- `dockerEnvironment` - Specify Docker environment (auto-detect if not provided)
- `allDockerConfigs` - Write all Docker configurations

### Result Tracking
- `filesWritten` - List of files created/modified
- `skillsInstalled` - List of successfully installed skills
- `skillsFailed` - List of skills that failed to install
- `warnings` - Any warnings during setup
- `errors` - Any errors during setup
- `nextSteps` - Suggested next steps for the user

### Re-exports
- Sub-module functions for direct access: writeClaudeMd, installSkills, writeHooksConfig, writeClaudeSettings, writeSandboxConfig, detectDockerEnvironment

### Type check: PASSED

## 2026-01-17 - impl-025: Implement init command for existing projects

### Completed
- Created `src/commands/init.ts` with full init command implementation
- Detects existing project configuration from package.json and config files
- Supports all frameworks: Next.js, TanStack Start, React Router v7, Astro, Expo, React Native CLI, Hono, Elysia
- Auto-detects package manager from lock files (bun, pnpm, yarn, npm)
- Updated `src/index.ts` to use the new handleInit from commands module

### Project Detection Features
- **Framework detection**: Analyzes dependencies to identify framework
- **Platform detection**: Determines web, mobile, universal, or api based on framework
- **Styling detection**: Tailwind, shadcn/ui, Tamagui, Uniwind, NativeWind, Unistyles
- **State detection**: Zustand, Jotai, TanStack Query
- **ORM detection**: Drizzle, Prisma
- **Backend detection**: Supabase, Convex, Firebase
- **Auth detection**: better-auth, Clerk, Supabase Auth
- **Linter detection**: oxlint, Biome, ESLint (from deps and config files)
- **Formatter detection**: oxfmt, Biome, Prettier (from deps and config files)
- **Testing detection**: Vitest, Jest, Playwright, Cypress, Detox, Maestro
- **Pre-commit detection**: Lefthook, Husky, prek (from deps and config files)

### User Flow
1. Validates project directory has package.json
2. Checks if Ralph is already initialized (CLAUDE.md, .claude/settings.json)
3. Analyzes project and displays detected configuration
4. User confirms or modifies detected configuration
5. User selects which Ralph components to set up (CLAUDE.md, skills, hooks, settings, Docker)
6. Runs `setupRalphInteractive()` with selected options
7. Displays results: files created, warnings, errors, next steps

### Exported Functions
- `handleInit()` - Main command handler
- `detectProjectConfig()` - Detect config from existing project
- `confirmConfiguration()` - User confirmation flow
- `promptSetupOptions()` - Setup component selection
- `readPackageJson()` - Read and parse package.json
- `detectFramework()` - Framework detection logic
- `detectPlatform()` - Platform detection logic

### Type check: PASSED

## 2026-01-17 - impl-026: Implement add command for post-scaffold features

### Completed
- Created `src/commands/add.ts` with comprehensive feature addition capabilities
- Supports adding 12 different feature types to existing projects
- Interactive feature selection menu when no feature is specified
- Provider/tool selection prompts for each feature type

### Addable Features
1. **auth** - Add better-auth, Clerk, or Supabase Auth
2. **orm** - Add Drizzle or Prisma ORM
3. **backend** - Add Supabase, Convex, Firebase, or custom backend
4. **state** - Add Zustand, Jotai, or TanStack Query
5. **styling** - Add Tailwind, shadcn/ui, or mobile styling solutions
6. **testing** - Add Vitest or Jest unit testing
7. **e2e** - Add Playwright, Cypress, Maestro, or Detox E2E testing
8. **linter** - Add oxlint, Biome, or ESLint
9. **formatter** - Add oxfmt, Prettier, or Biome
10. **hooks** - Add Lefthook, Husky, or prek pre-commit hooks
11. **skill** - Install openskills skill by name or from list
12. **ralph** - Full Ralph setup (CLAUDE.md, settings, skills)

### Technical Details
- Uses `detectProjectConfig()` from init.ts to analyze existing project
- Validates framework compatibility before adding features
- Framework-specific package selection (e.g., @clerk/nextjs vs @clerk/expo)
- Generates configuration files based on framework conventions
- Installs packages using project's detected package manager
- Supports --force, --yes, and --provider flags for automation
- Builds config objects conditionally to satisfy exactOptionalPropertyTypes
- Integrates with Ralph setup components (writeClaudeMd, writeClaudeSettings, installSkills, writeHooksConfig)

### File Generation
- Auth: auth.ts config, middleware.ts (Clerk/Next.js), .env.example
- ORM: drizzle.config.ts or prisma/schema.prisma, schema files, client files
- Backend: Client configuration files, setup instructions
- State: Example store/atoms files
- Testing: vitest.config.ts or jest.config.js, setup files
- E2E: playwright.config.ts, .maestro/, .detoxrc.js, example tests
- Linter: .oxlintrc.json or biome.json
- Formatter: .prettierrc
- Hooks: lefthook.yml, .husky/, or .pre-commit-config.yaml

### Exported Functions
- `handleAdd(args)` - Main CLI command handler
- `addFeature(feature, provider, options)` - Add feature to project
- `promptFeatureSelection()` - Interactive feature menu
- Individual handlers: addAuth, addORM, addBackend, addState, addStyling, addTesting, addE2E, addLinter, addFormatter, addHooks, addSkill, addRalph

### Type check: PASSED

## 2026-01-17 - impl-027: Implement SaaS preset

### Completed
- Created `src/presets/saas.ts` with comprehensive SaaS preset configuration
- Created `src/presets/index.ts` with preset registry and exports

### Features
- Main `SAAS_PRESET` configuration optimized for production SaaS apps:
  - Next.js with App Router
  - Tailwind CSS + shadcn/ui for rapid UI development
  - Drizzle ORM for type-safe database access
  - Supabase for database, realtime, and storage
  - better-auth for flexible authentication
  - Vercel deployment
  - Vitest + Playwright for testing
  - oxlint + oxfmt + prek for fast tooling

### Preset Variants
- `SAAS_CLERK_PRESET` - Uses Clerk for enterprise auth (MFA, SSO, organizations)
- `SAAS_PRISMA_PRESET` - Uses Prisma ORM instead of Drizzle
- `SAAS_TANSTACK_PRESET` - Uses TanStack Start instead of Next.js
- `SAAS_CONVEX_PRESET` - Uses Convex for real-time backend

### Helper Functions
- `getSaaSPreset()` - Get the default SaaS preset
- `getSaaSVariant(variant)` - Get a specific variant by name
- `getAllSaaSVariants()` - Get all SaaS preset variants
- `presetToProjectConfig(preset)` - Convert preset to project config format
- `formatPresetInfo(preset)` - Display preset information as formatted string

### Preset Registry (index.ts)
- `PRESETS` - Record of all presets by ID
- `getPreset(id)` - Get preset by ID
- `getAllPresets()` - Get all available presets
- `isValidPreset(id)` - Check if preset ID exists

### Technical Details
- PresetConfig interface includes: id, name, description, platform, framework, styling, state, orm, backend, auth, deployment, linter, formatter, unitTesting, e2eTesting, preCommit, packageManager, features list, skills list
- Each preset includes recommended skills from the SKILLS_MATRIX
- Variants use spread operator to inherit base configuration
- presetToProjectConfig handles optional properties correctly for exactOptionalPropertyTypes

### Type check: PASSED

## 2026-01-17 - impl-028: Implement Mobile preset

### Completed
- Created `src/presets/mobile.ts` with comprehensive Mobile preset configuration
- Updated `src/presets/index.ts` to export and register the Mobile preset

### Features
- Main `MOBILE_PRESET` configuration optimized for cross-platform mobile apps:
  - Expo (managed workflow) for cross-platform development
  - Uniwind for Tailwind-style styling (2.5x faster than NativeWind)
  - Expo Router for file-based navigation
  - Clerk for native mobile authentication
  - Supabase for backend services (database, storage, realtime)
  - EAS Build for cloud builds and deployment
  - Jest + Maestro for testing
  - oxlint + oxfmt + prek for fast tooling

### Preset Variants
- `MOBILE_BETTER_AUTH_PRESET` - Uses better-auth with @better-auth/expo for self-hosted auth
- `MOBILE_NATIVEWIND_PRESET` - Uses established NativeWind ecosystem
- `MOBILE_TAMAGUI_PRESET` - Uses Tamagui design system with optimizing compiler
- `MOBILE_CONVEX_PRESET` - Uses Convex for real-time backend
- `MOBILE_FIREBASE_PRESET` - Uses Firebase services (Firestore, Storage, Cloud Functions)
- `MOBILE_DETOX_PRESET` - Uses Detox for deterministic E2E testing

### Helper Functions
- `getMobilePreset()` - Get the default Mobile preset
- `getMobileVariant(variant)` - Get a specific variant by name
- `getAllMobileVariants()` - Get all Mobile preset variants

### Technical Details
- Follows same pattern as SaaS preset for consistency
- Uses spread operator for variants to inherit base configuration
- Includes appropriate skills from SKILLS_MATRIX for mobile development
- Registered in PRESETS registry for use with `--preset mobile` flag

### Type check: PASSED

## 2026-01-17 - impl-029: Implement API preset

### Completed
- Created `src/presets/api.ts` with comprehensive API preset configuration
- Updated `src/presets/index.ts` to export and register the API preset

### Features
- Main `API_PRESET` configuration optimized for edge-first API development:
  - Hono for edge-first, multi-runtime API development
  - Drizzle ORM for type-safe database access (with D1/LibSQL)
  - better-auth for API authentication (JWT, sessions)
  - Cloudflare Workers for edge deployment
  - Vitest for unit testing
  - oxlint + oxfmt + prek for fast tooling

### Preset Variants
- `API_ELYSIA_PRESET` - Bun-native API with Elysia for maximum performance, Fly.io deployment
- `API_PRISMA_PRESET` - Uses Prisma ORM with edge adapter
- `API_VERCEL_PRESET` - Serverless API with Hono on Vercel
- `API_NODE_PRESET` - Node.js API for traditional hosting (Railway/Render)
- `API_SUPABASE_PRESET` - API with Supabase for database and auth
- `API_FLY_PRESET` - Globally distributed API on Fly.io

### Helper Functions
- `getAPIPreset()` - Get the default API preset
- `getAPIVariant(variant)` - Get a specific variant by name
- `getAllAPIVariants()` - Get all API preset variants

### Technical Details
- Follows same pattern as SaaS and Mobile presets for consistency
- Uses spread operator for variants to inherit base configuration
- Includes appropriate skills from SKILLS_MATRIX for API development
- Registered in PRESETS registry for use with `--preset api` flag
- Uses `fly-io` deployment target (not `fly` - fixed type error)

### Type check: PASSED

## 2026-01-17 - impl-030: Implement Monorepo preset

### Completed
- Created `src/presets/fullstack.ts` with comprehensive Fullstack/Monorepo preset configuration
- Updated `src/presets/index.ts` to export and register the Fullstack preset

### Features
- Main `FULLSTACK_PRESET` configuration optimized for Turborepo monorepos:
  - Turborepo for monorepo management and build orchestration
  - Next.js for web application (apps/web)
  - Bun workspaces for package management (Turborepo 2.6+ stable support)
  - Shared packages: ui, db, tsconfig, eslint-config
  - Drizzle ORM for type-safe database access (shared schema)
  - Supabase for backend services
  - better-auth for authentication (shared across apps)
  - Tailwind CSS + shadcn/ui
  - Vitest + Playwright for testing
  - oxlint + oxfmt + prek for fast tooling
  - Remote caching with Turborepo
  - Parallel task execution

### Preset Variants
- `FULLSTACK_MOBILE_PRESET` - Adds Expo mobile app for universal (web + mobile) apps
- `FULLSTACK_TANSTACK_PRESET` - Uses TanStack Start instead of Next.js
- `FULLSTACK_CONVEX_PRESET` - Uses Convex for real-time backend
- `FULLSTACK_CLERK_PRESET` - Uses Clerk for enterprise auth (MFA, SSO, organizations)
- `FULLSTACK_PRISMA_PRESET` - Uses Prisma ORM instead of Drizzle
- `FULLSTACK_API_PRESET` - Adds Hono API service in apps/api

### Helper Functions
- `getFullstackPreset()` - Get the default Fullstack preset
- `getFullstackVariant(variant)` - Get a specific variant by name
- `getAllFullstackVariants()` - Get all Fullstack preset variants

### Technical Details
- Follows same pattern as SaaS, Mobile, and API presets for consistency
- Uses spread operator for variants to inherit base configuration
- Includes turborepo and monorepo-management skills for monorepo development
- Uses bun workspaces (not pnpm) per review-022 finding
- Documents --cwd flag usage for workspace-specific installs
- Registered in PRESETS registry for use with `--preset fullstack` flag

### Type check: PASSED

## 2026-01-17 - impl-031: Write unit tests for compatibility matrix

### Completed
- Created `vitest.config.ts` with test configuration for the project
- Created `tests/compatibility.test.ts` with comprehensive unit tests (114 tests total)

### Test Coverage
- **PLATFORMS**: Platform configuration, framework availability per platform
- **FRAMEWORKS**: All 8 framework configurations, bundler/routing/styling/testing options
- **INCOMPATIBILITY_RULES**: Rule structure validation, unique IDs
- **areSelectionsCompatible()**: Compatibility checking including:
  - Framework + routing conflicts (Next.js + TanStack Router, etc.)
  - Biome + ESLint/Prettier mutual exclusivity
  - Expo + Vitest/Playwright incompatibility
  - ORM and auth provider mutual exclusivity
  - Deployment target mutual exclusivity
- **getIncompatibleOptions()**: Returns all incompatible options for a selection
- **EDGE_COMPATIBILITY**: Edge runtime ORM support verification
- **checkEdgeORMCompatibility()**: Cloudflare/Vercel/Railway/Fly.io ORM requirements
- **STYLING_COMPATIBILITY**: Platform-specific styling options
- **getStylingForPlatform()**: Web/mobile/universal styling filtering
- **getRecommendedStyling()**: Default styling per platform
- **TESTING_COMPATIBILITY**: Unit and E2E testing framework options
- **LINTERS & FORMATTERS**: Configuration structure, speed, stability
- **DEFAULTS**: Default recommendations for all platforms
- **getFrameworksForPlatform()**: Platform to framework mapping
- **getFrameworkConfig()**: Framework configuration retrieval
- **SKILLS_MATRIX**: Skill definitions and conditions
- **getSkillsForConfig()**: Config-based skill selection with deduplication

### Technical Details
- Vitest configured with v8 coverage provider
- Tests use .js extension in imports for ESM compatibility
- Test file located in tests/ directory (outside src/)
- All 114 tests passing

### Type check: PASSED
### Tests: 114 passed

## 2026-01-17 - impl-032: Write unit tests for filtering logic

### Completed
- Created `tests/filters.test.ts` with comprehensive unit tests (104 tests total)
- Tests cover all filter functions in `src/compatibility/filters.ts`

### Test Coverage
- **getAvailableFrameworks()**: Framework filtering by platform, recommended flags
- **getAvailableStyling()**: Platform/framework-aware styling filtering, web/mobile/universal distinctions
- **getAvailableStateManagement()**: State management options by framework
- **getAvailableORM()**: ORM options by framework (Drizzle, Prisma, none)
- **getAvailableBackend()**: Backend options by framework (Supabase, Firebase, Convex, custom)
- **getAvailableAuth()**: Auth provider options with framework-aware descriptions, Supabase recommendation
- **getAvailableLinters()**: Linter options (oxlint, Biome, ESLint)
- **shouldShowFormatterQuestion()**: Biome mutual exclusivity logic
- **getAvailableFormatters()**: Formatter options based on linter selection
- **getAvailableUnitTesting()**: Platform-aware unit testing frameworks (Vitest vs Jest)
- **getAvailableE2ETesting()**: Platform-aware E2E testing frameworks (Playwright/Cypress vs Maestro/Detox)
- **getAvailableDeployment()**: Framework-specific deployment targets
- **filterOptions()**: Generic incompatibility filtering
- **validateSelections()**: Full selection validation with error detection

### Test Categories
- Framework filters: 8 tests
- Styling filters: 9 tests
- State management filters: 6 tests
- ORM filters: 6 tests
- Backend filters: 6 tests
- Auth filters: 9 tests
- Linter filters: 3 tests
- Formatter filters: 8 tests
- Unit testing filters: 9 tests
- E2E testing filters: 9 tests
- Deployment filters: 10 tests
- Generic filter options: 6 tests
- Validate selections: 11 tests
- Integration tests: 4 tests

### Technical Details
- Tests verify FilteredOption interface compliance (value, label, description, recommended)
- Tests verify incompatibility rule enforcement (Biome+ESLint, Biome+Prettier, Expo+Vitest, etc.)
- Tests verify platform-specific recommendations match DEFAULTS from matrix
- Integration tests verify consistent options for SaaS (Next.js), Mobile (Expo), and API (Hono) presets

### Type check: PASSED
### Tests: 218 passed (114 compatibility + 104 filters)

## 2026-01-17 - impl-033: Write integration tests for scaffolders

### Completed
- Created `tests/scaffolders.test.ts` with comprehensive integration tests (107 tests total)
- Tests cover all 7 scaffolder modules without invoking external CLIs

### Test Coverage

#### Next.js Scaffolder (40 tests)
- **buildCreateNextAppArgs**: Package manager flags, App/Pages Router, Tailwind options, turbopack, import alias
- **collectAdditionalDependencies**: State management (Zustand, Jotai, TanStack Query), ORM (Drizzle, Prisma), backend (Supabase, Convex, Firebase), auth (Clerk, better-auth, Supabase Auth), testing (Vitest, Jest), E2E (Playwright, Cypress), linting (oxlint, Biome), formatting (Prettier, oxfmt), pre-commit hooks (Lefthook, Husky)
- **buildNextSteps**: cd command, env setup, ORM push commands, Playwright install, pre-commit install

#### TanStack Start Scaffolder (10 tests)
- **buildCreateStartArgs**: Biome/ESLint toolchain, shadcn/TanStack Query add-ons, package manager support
- **collectAdditionalDependencies**: State management, edge-compatible ORM deps, auth deps, testing deps
- **buildNextSteps**: cd command, ORM setup steps

#### React Router v7 Scaffolder (6 tests)
- **buildCreateReactRouterArgs**: Basic args, template flag
- **collectAdditionalDependencies**: Edge-compatible ORM deps for Cloudflare/Vercel
- **buildNextSteps**: Dev command with package manager

#### Expo Scaffolder (15 tests)
- **buildCreateExpoStackArgs**: Expo Router/React Navigation, NativeWind/Tamagui/Uniwind styling, package manager (--yarn format)
- **collectAdditionalDependencies**: Uniwind migration, Clerk/better-auth Expo SDKs, Supabase with AsyncStorage, Convex React Native, Firebase RN, testing-library deps, Detox E2E
- **buildNextSteps**: EAS setup, expo start command

#### React Native CLI Scaffolder (9 tests)
- **checkPrerequisites**: hasXcode, hasAndroidStudio properties
- **collectAdditionalDependencies**: Testing-library deps (always added), better-auth RN SDK, Clerk deps, state management, Detox E2E
- **buildNextSteps**: Platform-specific run commands, Fastlane setup

#### Astro Scaffolder (11 tests)
- **buildCreateAstroArgs**: Template, TypeScript strict, --no-git, --yes flags
- **collectAdditionalDependencies**: Clerk Astro SDK, better-auth, Prettier with Astro plugin, Drizzle, Vitest, backend deps
- **buildNextSteps**: Astro dev command

#### API (Hono/Elysia) Scaffolder (11 tests)
- **getHonoTemplate**: Cloudflare Workers, Vercel, Netlify, Node.js templates
- **collectAdditionalDependencies**: Drizzle with D1/Neon drivers, Prisma with edge adapter, better-auth, Vitest, wrangler
- **buildNextSteps**: Framework-specific dev commands, wrangler info

#### Cross-Scaffolder Integration (5 tests)
- Consistent ScaffoldResult interface across all scaffolders
- Common package manager support (bun, pnpm, npm, yarn)
- Consistent ORM dependencies across web frameworks
- Consistent auth dependencies across web frameworks
- Platform-appropriate testing (Vitest for web, Jest/testing-library for mobile)

### Technical Details
- Tests use internal interfaces (CreateStartArgsOptions, CreateExpoStackArgsOptions, etc.) matching actual implementations
- Verified styling deps handled by separate setup functions (not collectAdditionalDependencies) for RN CLI and Astro
- Verified Jest comes with React Native/Expo presets, so scaffolders only add testing-library deps
- Verified package manager flag formats differ by scaffolder (--use-bun vs --bun vs --yarn)

### Type check: PASSED
### Tests: 325 passed (114 compatibility + 104 filters + 107 scaffolders)

## 2026-01-17 - impl-034: Write E2E tests for full wizard flow

### Completed
- Fixed existing `tests/e2e.test.ts` with 76 comprehensive E2E tests
- Tests cover the complete flow from preset/config to scaffolder options
- All tests pass without invoking external CLIs or interactive prompts

### Test Coverage

#### Preset Configurations (11 tests)
- PRESET_CONFIGS validation (all presets defined, valid platforms, valid frameworks, compatibility)
- applyPreset() for all 6 presets (saas, mobile, api, content, universal, fullstack)
- Preset validation (all presets pass validateAllSelections)

#### Preset Modules (18 tests)
- Preset Registry (getAllPresets returns array, isValidPreset, getPreset by ID)
- SaaS Preset (default, variants array, specific variant retrieval)
- Mobile Preset (default, variants array, specific variant retrieval)
- API Preset (default, variants array, specific variant retrieval)
- Fullstack Preset (default, variants array, specific variant retrieval)

#### Create Command Flow (6 tests)
- Configuration building (valid web, mobile, API configs)
- Invalid configuration detection (Expo+Vitest, Biome+ESLint, Expo+Playwright)

#### Init Command Flow (23 tests)
- Project detection (Next.js, Expo, TanStack Start, React Router v7, Astro, Hono, Elysia, RN CLI)
- Feature detection (Drizzle, Prisma, Supabase, Firebase, Clerk, better-auth, Tailwind, shadcn, state libs)
- Tooling detection (oxlint, Biome, ESLint, Vitest, Jest, Playwright, Lefthook, Husky)
- Package manager detection (bun, pnpm, yarn, npm via lock files)

#### Platform-Framework Compatibility (5 tests)
- Valid frameworks for each platform (web, mobile, universal, api)
- Consistent defaults for each platform

#### End-to-End Config Flow (6 tests)
- Valid scaffolder config production for all 6 presets (SaaS, Mobile, API, Content, Universal, Fullstack)

#### Validation Edge Cases (4 tests)
- Empty selections handling
- Partial selections handling
- Minimal valid configuration
- Multiple incompatibility detection

### Bug Fixes During Implementation
- Fixed test expectations for `getAllPresets()` - returns array, not object
- Fixed test expectations for `getAllSaaSVariants()`, `getAllMobileVariants()`, etc. - return arrays with preset IDs
- Fixed Fullstack mobile variant feature check (look for "Expo mobile app" string)
- Fixed DEFAULTS.e2eTesting.api expectation (is 'playwright', not undefined)
- Fixed empty selections validation expectation (validator checks conflicts, not required fields)

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-17 - impl-035: Create README documentation

### Completed
- Verified existing README.md is comprehensive and up-to-date
- README already contains all necessary documentation including:
  - Ralph Loop pattern explanation and AFK mode usage
  - Cost warning about token usage
  - Features overview with compatibility-aware selection
  - Supported frameworks table (Next.js, TanStack Start, React Router v7, Expo, RN CLI, Astro, Hono/Elysia)
  - Quick start guide with prerequisites
  - Preset configurations (saas, mobile, api, fullstack)
  - PRD commands (prd, ralph, afk-ralph.sh)
  - Project structure documentation
  - Compatibility matrix examples
  - Skills installation table by stack
  - Docker sandbox configuration
  - Configuration tables (tooling defaults, auth providers, deployment targets)
  - Development instructions

### Technical Details
- README includes all commands: create, init, add, prd, ralph
- Preset documentation matches implemented presets (saas, mobile, api, content, universal, fullstack)
- Skills matrix documentation matches SKILLS_MATRIX from src/compatibility/matrix.ts
- Docker approaches documented: sandbox, devcontainer, custom Dockerfile

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-17 - impl-036: Configure npm publishing

### Completed
- Updated `package.json` with complete npm publishing configuration
- Added `homepage` field pointing to GitHub repository README
- Added `publishConfig` with public access and npm registry URL
- Added `sideEffects: false` for better tree-shaking in bundlers

### Existing Configuration (already in place)
- `name`, `version`, `description`, `license`, `author`
- `main`, `module`, `types`, `exports` for dual ESM/CJS support
- `bin` for CLI executable (`bootstralph`)
- `files` array limiting published files to `dist/` only
- `prepublishOnly` script to build before publish
- `engines` field requiring Node.js 18.19.0+
- `keywords` for npm search discoverability
- `repository` and `bugs` URLs

### Package Contents (verified via npm pack --dry-run)
- README.md (10.6kB)
- dist/index.js (406.0kB) - ESM bundle
- dist/index.cjs (415.7kB) - CommonJS bundle
- dist/index.d.ts + dist/index.d.cts - TypeScript declarations
- Source maps for debugging
- Total package size: 471.4kB (compressed)

### Publishing Instructions
```bash
# Login to npm (first time only)
npm login

# Publish to npm
npm publish

# Or with explicit public access
npm publish --access public
```

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)
### Build: PASSED

## 2026-01-17 - impl-037: Add OpenTUI and SolidJS dependencies

### Completed
- Installed OpenTUI and SolidJS dependencies: @opentui/core, @opentui/solid, solid-js
- Configured TypeScript for SolidJS JSX compilation (jsx: preserve, jsxImportSource: solid-js)
- Updated tsup.config.ts to use esbuild-plugin-babel with babel-preset-solid for TSX files
- Added babel dev dependencies: @babel/core, @babel/preset-typescript, babel-preset-solid, esbuild-plugin-babel

### Technical Details
- OpenTUI v0.1.74 installed (latest, uses Zig FFI for performance-critical rendering)
- SolidJS v1.9.9 installed (stable)
- Babel preset configured with @babel/preset-typescript for type stripping and babel-preset-solid for JSX transformation
- Build uses esbuild-plugin-babel with filter: /\.tsx$/ to only transform SolidJS TSX files
- Non-TSX TypeScript files continue to use esbuild's native TypeScript handling

### Package Updates
- Dependencies added: @opentui/core ^0.1.74, @opentui/solid ^0.1.74, solid-js ^1.9.9
- Dev dependencies added: @babel/core ^7.28.6, @babel/preset-typescript ^7.28.5, babel-preset-solid ^1.9.9, esbuild-plugin-babel ^0.2.3

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)
### Build: PASSED

## 2026-01-17 - impl-038: Create TUI state store with SolidJS signals

### Completed
- Created `src/tui/state/store.ts` with comprehensive reactive state management
- Implemented SolidJS signals for all TUI state: logs, currentTask, isPaused, progress, inputHistory, currentPrd
- Added derived state via createMemo: progressPercentage, hasPendingTasks, statusText, nextTask

### State Signals
- `logs` - Array of LogEntry with level, message, timestamp, optional source
- `currentTask` - Current task being worked on (id, title, description, startedAt)
- `isPaused` - Whether Ralph loop is paused
- `progress` - { completed, total, iteration, maxIterations }
- `inputHistory` - Command history for up/down arrow navigation
- `currentPrd` - The loaded PRD object
- `currentPrdFile` - Filename of the loaded PRD
- `autoScroll` - Whether log pane auto-scrolls
- `isRunning` - Whether TUI is running

### Actions Implemented
- Log management: addLog, addLogs, clearLogs (with 500 line limit)
- Task management: startTask, completeTask, skipTask
- Pause control: pause, resume, togglePause
- Progress tracking: updateProgressFromPrd, incrementIteration, setMaxIterations, resetIteration
- Input history: addToHistory, getHistoryCommand (100 entry limit)
- PRD management: loadPrd, updatePrd, unloadPrd
- TUI lifecycle: start, stop, reset

### Technical Details
- Uses SolidJS batch() for atomic multi-signal updates
- Proper handling of exactOptionalPropertyTypes for optional fields
- MAX_LOGS = 500 to prevent memory/CPU issues
- MAX_INPUT_HISTORY = 100 for command recall
- LogEntry levels: info, warn, error, success, debug, stdout, stderr
- Store exported as const object for consistent API

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-17 - impl-039: Create LogPane component with virtualized scrolling

### Completed
- Created `src/tui/components/LogPane.tsx` with full log pane implementation using OpenTUI
- Uses OpenTUI ScrollBox for scrollable log output
- Integrates with TUI state store for reactive updates

### Features
- **LogPane component**: Main scrollable log output pane
  - Uses `@jsxImportSource @opentui/solid` pragma for OpenTUI JSX types
  - Scrollbox with stickyScroll=true and stickyStart="bottom" for auto-scroll
  - Viewport culling for performance
  - Log entries limited to 500 (enforced by store)
  - Auto-scroll indicator when scroll is paused

- **LogEntryRow component**: Renders individual log entries
  - Level-based color coding: error (red), warn (yellow), success (green), info (blue), debug (gray), stdout (white), stderr (light red)
  - Optional timestamps display (HH:MM:SS format)
  - Optional source display (e.g., [claude], [system], [user])
  - Level prefix indicators: [ERR], [WRN], [OK], [INF], [DBG]

- **LogPaneWithControls component**: LogPane with keyboard shortcut hints
  - Shows [C]lear | [A]uto-scroll controls footer

### Props Interface
- `height?: number | \`${number}%\`` - Fixed height (defaults to flex: 1)
- `showTimestamps?: boolean` - Show timestamps (default: true)
- `showSource?: boolean` - Show log source (default: true)
- `borderColor?: string` - Border color as hex string (default: "#444444")
- `title?: string` - Pane title (default: "Logs")

### Technical Details
- Uses OpenTUI's ScrollBoxRenderable for programmatic scrollTo()
- Colors as hex strings (e.g., "#ff5555") per OpenTUI RGBA/ColorInput types
- Border set with border={true} and borderStyle="single" (not { all: "single" })
- createEffect for auto-scroll when logs update
- process.nextTick() ensures layout updates before scrolling
- Proper TypeScript types with ScrollBoxRenderable ref

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)
### Build: PASSED

## 2026-01-17 - impl-040: Create StatusBar component

### Completed
- Created `src/tui/components/StatusBar.tsx` with full status bar implementation using OpenTUI
- Integrates with TUI state store for reactive updates

### Features
- **StatusBar component**: Main status bar with task, progress, and state display
  - Uses `@jsxImportSource @opentui/solid` pragma for OpenTUI JSX types
  - Shows current task ID and title with elapsed time
  - Progress bar with percentage and X/Y count
  - Iteration count (iter X/Y)
  - Status indicator: RUNNING (green), PAUSED (yellow), STOPPED (gray)
  - Configurable border and background colors

- **CompactStatusBar component**: Single-line minimal variant
  - Shows essential info in one line: [STATUS] taskId | X/Y (pct%) | iter X/Y
  - Useful for space-constrained layouts

- **StatusBarWithPrd component**: StatusBar with PRD info header
  - Shows PRD name and filename above the main status bar
  - Uses partial borders (top/left/right) for visual connection

### Helper Functions
- `getStatusColor(status)` - Returns color based on RUNNING/PAUSED/STOPPED state
- `getProgressColor(percentage)` - Returns color gradient based on completion percentage
- `formatElapsedTime(startedAt)` - Formats time as "Xh Ym", "Xm Ys", or "Xs"
- `buildProgressBar(percentage, width)` - Creates text-based progress bar with █ and ░ characters

### Technical Details
- Uses createMemo for computed values (progressText, iterationText, taskText, progressBar)
- Conditionally builds box props to satisfy exactOptionalPropertyTypes
- Colors as hex strings (e.g., "#55ff55") per OpenTUI RGBA/ColorInput types
- Uses backgroundColor (not bg) per OpenTUI BoxOptions interface
- Border sides can be specified as array: ["top", "left", "right"]

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)
## 2026-01-18 - impl-041: Create InputBar component with command input

### Completed
- Created `src/tui/components/InputBar.tsx` with full command input implementation using OpenTUI
- Uses OpenTUI Input element for keyboard capture (not Textarea as originally planned - Input is simpler for single-line commands)
- Integrates with TUI state store for history and pause state

### Features
- **InputBar component**: Main command input with full functionality
  - Uses `@jsxImportSource @opentui/solid` pragma for OpenTUI JSX types
  - Submit on Enter via onSubmit handler
  - History navigation with up/down arrows (navigates through store.inputHistory)
  - Saves current input when navigating back in history, restores on down arrow past index 0
  - Visual feedback for slash commands with color coding:
    - Control commands (pause, resume, skip, abort): Yellow
    - PRD modification commands (issue, note, priority): Cyan
    - Info commands (status, help): Green
    - Invalid commands: Red
  - Valid command indicator in hint bar
  - Prompt color reflects state: Green (active), Yellow (paused), Gray (disabled)
  - Escape key clears input

- **InputBarWithSuggestions component**: InputBar with command autocomplete dropdown
  - Shows filtered command suggestions when typing "/" without space
  - Displays up to 5 matching commands
  - Available commands: issue, pause, resume, skip, status, note, priority, abort, help, clear

- **CompactInputBar component**: Minimal single-line variant
  - No border, single row height
  - Prompt + input display only
  - Suitable for space-constrained layouts

### Props Interface
- `onSubmit?: (input: string) => void` - Callback when command is submitted
- `placeholder?: string` - Placeholder text when empty
- `borderColor?: string` - Custom border color (hex string)
- `bgColor?: string` - Custom background color
- `disabled?: boolean` - Whether input is disabled
- `prompt?: string` - Prompt prefix (default: ">")

### Technical Details
- Uses OpenTUI's InputRenderable (not TextareaRenderable) for simpler single-line input
- Hidden input element positioned off-screen captures keyboard events
- Visual display uses separate text elements for colored command preview
- onKeyDown handler receives KeyEvent from @opentui/core
- onSubmit receives the value directly from Input component
- History index -1 means "not navigating history"
- createMemo for parsed input, command colors, and validation status
- createEffect for auto-focus on mount

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-042: Create main TUI App component and entry point

### Completed
- Created `src/tui/App.tsx` with full TUI application layout using OpenTUI + SolidJS
- Created `src/tui/index.tsx` with TUI entry point, start/stop functions, and convenience APIs

### Features - App.tsx
- **App component**: Main TUI layout with flexbox structure
  - Uses `@jsxImportSource @opentui/solid` pragma for OpenTUI JSX types
  - Header with optional title (hidden in compact mode)
  - LogPane (flex: 1) - scrollable log output
  - StatusBar - current task and progress display
  - InputBar - command input with suggestions
  - Footer with keyboard shortcuts (hidden in compact mode)
  - Responsive layout: compact mode for terminals < 20 rows or < 60 cols
- **MinimalApp component**: Streamlined variant for simple use cases
- **FullApp component**: All features enabled variant
- **useGlobalKeyboard hook**: Global keyboard shortcut handler
  - Ctrl+C: Abort/Exit
  - Ctrl+P: Pause/Resume toggle
  - Ctrl+L: Clear logs
  - Ctrl+A: Toggle auto-scroll
- **AppProps interface**: Configuration with exactOptionalPropertyTypes support

### Features - index.tsx (Entry Point)
- **startTui(options)**: Start the TUI with full configuration
  - Accepts PRD, maxIterations, debug mode, all AppProps
  - Returns TuiInstance with stop(), store, exitPromise
  - Handles exactOptionalPropertyTypes by building props conditionally
- **startMinimalTui(onCommand)**: Start minimal TUI variant
- **stopTui()**: Stop and cleanup the TUI
- **isTuiRunning()**: Check if TUI is currently running
- **Convenience functions**: tuiLog, tuiStartTask, tuiCompleteTask, tuiSkipTask, tuiPause, tuiResume, tuiLoadPrd, tuiUpdatePrd, tuiIncrementIteration, tuiClearLogs
- **Re-exports**: All components, store, and types for external use

### Technical Details
- Uses `render()` from @opentui/solid (returns Promise<void>, not renderer instance)
- `useKeyboard(callback)` takes callback directly (not event emitter pattern)
- `useTerminalDimensions()` returns Accessor<{width, height}> for reactive resize handling
- KeyEvent type imported from @opentui/core for type-safe keyboard handling
- File renamed from index.ts to index.tsx for JSX support
- Props built conditionally to satisfy exactOptionalPropertyTypes
- Exit promise pattern for controlled TUI shutdown

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-043: Implement slash command parser

### Completed
- Created `src/tui/commands/types.ts` with comprehensive type definitions for slash commands
- Created `src/tui/commands/parser.ts` with full command parsing implementation
- Created `src/tui/commands/index.ts` for module exports

### Features - types.ts
- **CommandName type**: Union of all supported command names (issue, pause, resume, skip, status, note, priority, abort, help, clear)
- **CommandCategory type**: Categories for grouping (control, prd, info, system)
- **ParsedCommand interface**: Complete parsed result with isCommand, name, rawArgs, args array, isValid, category
- **CommandDefinition interface**: Metadata including usage, description, examples, arg requirements
- **Command-specific args interfaces**: IssueCommandArgs, NoteCommandArgs, PriorityCommandArgs, SkipCommandArgs, AbortCommandArgs, StatusCommandArgs
- **CommandResult interface**: Execution result with success, message, error, data
- **ParseError interface**: Error info with type, message, command, usage

### Features - parser.ts
- **COMMAND_DEFINITIONS**: Complete definitions for all 10 commands with usage, examples, arg limits
- **VALID_COMMAND_NAMES**: Array of valid command names
- **getCommandCategory()**: Get category from command name
- **isValidCommand()**: Type guard for command validation
- **getCommandDefinition()**: Get full definition by name
- **tokenize()**: Parse input respecting quoted strings (single and double quotes)
- **parseCommand()**: Main parser function extracting name, rawArgs, args array
- **validateCommand()**: Validate arg count against command requirements
- **parseAndValidate()**: Combined parse + validate in one call
- **Command-specific parsers**: parseIssueArgs, parseNoteArgs, parsePriorityArgs, parseSkipArgs, parseAbortArgs, parseStatusArgs
- **getCategoryColor()**: Get hex color for UI styling (yellow=control, cyan=prd, green=info, magenta=system)
- **getHelpText()**: Generate help text for one or all commands grouped by category
- **getCommandSuggestions()**: Get matching commands for autocomplete
- **formatCommandResult()**: Format command result for display

### Technical Details
- Proper handling of exactOptionalPropertyTypes for optional args
- Task ID pattern matching for /note command (impl-XXX, us-XXX, review-XXX)
- Flag parsing for /abort (--force, -f) and /status (-v, --verbose)
- Unlimited args (-1 maxArgs) for description/reason commands
- Re-exports all types from types.ts for single import point

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-044: Implement PRD manager for CRUD operations

### Completed
- Created `src/ralph/prd-manager.ts` with comprehensive PRD management functionality
- Supports both standard UserStory format and extended implementation_tasks format
- Auto-save with configurable debounce (default 500ms)

### Features
- **PrdManager class**: Main class for CRUD operations
  - `load(filePath)` - Load PRD from JSON file
  - `save()` - Save PRD with pretty formatting
  - `flush()` - Force immediate save, clearing debounce timer
  - `isDirty()` - Check if changes are pending save

- **Task Retrieval**:
  - `getAllTasks()` - Get all tasks (implementation_tasks or userStories)
  - `getTask(id)` - Get task by ID
  - `getNextTask()` - Get next pending task with highest priority
  - `getPendingTasks()` - Get all pending tasks
  - `getCompletedTasks()` - Get all completed tasks

- **Progress Tracking**:
  - `getProgress()` - Get progress statistics (total, completed, remaining, percentage)
  - `isComplete()` - Check if PRD is complete

- **CRUD Operations**:
  - `addIssue(options)` - Add new task with auto-generated ID
  - `updateNote(options)` - Update task note with timestamp, optional append mode
  - `updatePriority(options)` - Update task priority/phase
  - `markComplete(taskId)` - Mark task as completed with timestamp
  - `markSkipped(taskId, reason?)` - Mark task as skipped with reason note
  - `startTask(taskId)` - Mark task as in_progress with start timestamp
  - `updateStatus(status)` - Update overall PRD status

- **Review Tasks**:
  - `getReviewTasks()` - Get all review tasks
  - `getPendingReviewTasks()` - Get pending review tasks
  - `updateReviewFinding(id, finding, actionRequired?)` - Update review task finding

- **Static Helpers**:
  - `PrdManager.fileExists(path)` - Check if file exists
  - `PrdManager.findPrdFiles(dir)` - Find PRD files in directory
  - `PrdManager.create(name, description, dir?)` - Create new PRD file

- **Singleton Support**:
  - `getDefaultPrdManager()` - Get singleton instance
  - `resetDefaultPrdManager()` - Reset singleton (for testing)

### Technical Details
- Uses `| null` pattern instead of `| undefined` for exactOptionalPropertyTypes compliance
- ID generation uses same prefix as existing tasks (e.g., `impl-057` continues from `impl-056`)
- Notes include ISO timestamp prefix: `[2026-01-18 00:18:45] Note text`
- Supports both `review_tasks` and `reviewTasks` property names
- Triggers `onUpdate` callback after each mutation for TUI integration
- Cleanup via `destroy()` method flushes pending saves

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-045: Implement /issue command handler

### Completed
- Created `src/tui/commands/issue.ts` with full /issue command implementation
- Integrates with PrdManager for task creation
- Integrates with TUI store for logging and progress updates

### Features
- **executeIssueCommand(options)**: Main execution function
  - Accepts raw input string or pre-parsed IssueCommandArgs
  - Uses PrdManager singleton by default (can override)
  - Auto-generates task ID based on existing pattern (impl-XXX or US-XXX)
  - Supports optional priority/phase override
  - Updates store progress after adding task
  - Logs success/error to TUI log pane

- **handleIssueCommand(input)**: Convenience function for raw command handling

- **createIssue(description, options)**: Programmatic issue creation
  - Direct API for creating issues without command parsing

- **validateIssueInput(input)**: Pre-validation for UI
  - Validates input without executing
  - Returns parsed args if valid
  - Useful for input field validation before submission

- **getIssueHelp()**: Returns help text for the command

### Technical Details
- Handles exactOptionalPropertyTypes by conditionally building result objects
- Parses description from rawArgs (supports quoted strings via parser)
- Uses PrdManager.addIssue() which handles both implementation_tasks and userStories formats
- Updates TUI store progress via setProgress() after successful creation
- All errors logged to store with "error" level for TUI display

### Updated Exports
- Added exports to src/tui/commands/index.ts:
  - executeIssueCommand, handleIssueCommand, createIssue, validateIssueInput, getIssueHelp
  - IssueCommandOptions type

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-046: Implement /pause and /resume command handlers

### Completed
- Created `src/tui/commands/pause.ts` with full pause/resume command implementation
- Integrates with TUI store for isPaused signal management
- Both commands log status changes to TUI log pane

### Features
- **executePauseCommand(options)**: Main /pause execution function
  - Validates input if provided as raw string
  - Checks if already paused (returns success with alreadyPaused flag)
  - Checks if TUI is running (returns error if not)
  - Calls store.pause() which sets isPaused signal and logs status
  - Returns helpful message: "Ralph loop paused. Use /resume to continue."

- **executeResumeCommand(options)**: Main /resume execution function
  - Validates input if provided as raw string
  - Checks if already running (returns success with alreadyRunning flag)
  - Calls store.resume() which clears isPaused signal and logs status
  - Returns message: "Ralph loop resumed"

- **handlePauseCommand(input)**: Convenience for raw /pause command
- **handleResumeCommand(input)**: Convenience for raw /resume command
- **pauseRalph(showInLogs)**: Programmatic pause without parsing
- **resumeRalph(showInLogs)**: Programmatic resume without parsing
- **togglePause(showInLogs)**: Toggle between pause/resume states
- **isPaused()**: Check current pause state
- **getPauseHelp()**: Help text for /pause command
- **getResumeHelp()**: Help text for /resume command

### Technical Details
- Commands integrate with existing store.pause() and store.resume() functions
- Status changes logged to TUI with appropriate levels (warn for pause, info for resume)
- showInLogs option allows silent operation for programmatic use
- Engine will check store.isPaused() between iterations to honor pause state
- Proper error handling for edge cases (already paused, not running)

### Updated Exports
- Added exports to src/tui/commands/index.ts:
  - executePauseCommand, executeResumeCommand, handlePauseCommand, handleResumeCommand
  - pauseRalph, resumeRalph, togglePause, isPaused, getPauseHelp, getResumeHelp
  - PauseCommandOptions type

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-047: Implement /skip command handler

### Completed
- Created `src/tui/commands/skip.ts` with full /skip command implementation
- Integrates with PrdManager for marking tasks as skipped in PRD
- Integrates with TUI store for updating current task and progress

### Features
- **executeSkipCommand(options)**: Main /skip execution function
  - Validates input if provided as raw string
  - Checks for current task (returns error if none)
  - Checks for loaded PRD (returns error if none)
  - Calls PrdManager.markSkipped() which adds timestamped skip note
  - Calls store.skipTask() to clear current task in TUI
  - Updates store progress from PRD manager
  - Logs success/error to TUI log pane

- **handleSkipCommand(input)**: Convenience for raw /skip command
- **skipCurrentTask(reason, options)**: Programmatic skip without parsing
- **validateSkipInput(input)**: Pre-validation for UI
  - Validates input without executing
  - Returns parsed args if valid
  - Useful for input field validation before submission
- **getSkipHelp()**: Returns help text for the command

### Technical Details
- Handles exactOptionalPropertyTypes by conditionally building result objects
- Parses optional reason from rawArgs (supports multiple words, quoted strings)
- Uses PrdManager.markSkipped() which handles both implementation_tasks and userStories formats
- Skip note includes timestamp: "[2026-01-18 00:27:45] Skipped by user: reason"
- Updates TUI store progress via setProgress() after successful skip
- All errors logged to store with "error" level for TUI display

### Updated Exports
- Added exports to src/tui/commands/index.ts:
  - executeSkipCommand, handleSkipCommand, skipCurrentTask, validateSkipInput, getSkipHelp
  - SkipCommandOptions type

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-048: Implement /status command handler

### Completed
- Created `src/tui/commands/status.ts` with full /status command implementation
- Integrates with PrdManager for progress and task details retrieval
- Integrates with TUI store for current task info and logging
- Read-only command that does not modify the PRD

### Features
- **executeStatusCommand(options)**: Main /status execution function
  - Validates input if provided as raw string
  - Retrieves progress from PRD manager (total, completed, pending, percentage)
  - Gets current task from TUI store with elapsed time
  - Supports optional task ID for detailed task info
  - Supports -v/--verbose flag for review task summary
  - Formats output with progress bar and structured display
  - Logs status to TUI log pane

- **handleStatusCommand(input)**: Convenience for raw /status command
- **getStatus(options)**: Programmatic status retrieval without parsing
  - Returns StatusInfo object or null if no PRD loaded
- **validateStatusInput(input)**: Pre-validation for UI
  - Validates input without executing
  - Returns parsed args if valid
- **getStatusHelp()**: Returns help text for the command

### StatusInfo Interface
- prdName, prdStatus: PRD identification
- total, completed, pending, inProgress: Task counts
- percentage: Completion percentage
- currentTask: Optional current task with id, title, status, elapsedTime
- taskDetails: Optional specific task details (if task ID provided)
- reviewSummary: Optional review tasks summary (verbose mode)

### Display Format
- Bordered header with PRD name and status
- Text-based progress bar with percentage
- Completed/pending/in-progress counts
- Current task section with elapsed time
- Task details section (if specific task requested)
- Review summary section (verbose mode only)

### Technical Details
- Handles exactOptionalPropertyTypes by conditionally building result objects
- Supports both ImplementationTask and UserStory formats via type guards
- formatElapsedTime() converts startedAt timestamps to human-readable format
- buildProgressBar() creates text-based progress visualization
- All errors logged to store with appropriate levels

### Updated Exports
- Added exports to src/tui/commands/index.ts:
  - executeStatusCommand, handleStatusCommand, getStatus, validateStatusInput, getStatusHelp
  - StatusCommandOptions, StatusInfo types

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-049: Implement /note command handler

### Completed
- Created `src/tui/commands/note.ts` with full /note command implementation
- Integrates with PrdManager for updating task notes
- Integrates with TUI store for current task retrieval and logging

### Features
- **executeNoteCommand(options)**: Main /note execution function
  - Validates input if provided as raw string
  - Checks for loaded PRD (returns error if none)
  - Supports optional task ID to specify which task to add note to
  - If no task ID provided, uses current task from store
  - Appends note with timestamp to task's notes field
  - Logs success/error to TUI log pane

- **handleNoteCommand(input)**: Convenience for raw /note command
- **addNote(content, options)**: Programmatic note addition with options
  - Supports taskId, append, and prdManager options
- **addNoteToCurrentTask(content, append)**: Simple helper for current task notes
- **validateNoteInput(input)**: Pre-validation for UI
  - Validates input without executing
  - Returns parsed args if valid
  - Useful for input field validation before submission
- **getNoteHelp()**: Returns help text for the command

### Usage Examples
- `/note User requested this feature` - Adds note to current task
- `/note impl-045 Blocked by API rate limits` - Adds note to specific task
- `/note "Multiple words in quotes work too"` - Supports quoted content

### Technical Details
- Handles exactOptionalPropertyTypes by conditionally building options objects
- Uses parseNoteArgs() which detects task ID patterns (impl-XXX, us-XXX, review-XXX)
- Notes are appended with timestamp: `[2026-01-18 00:34:15] Note content`
- Default append=true to preserve existing notes
- All errors logged to store with "error" level for TUI display

### Updated Exports
- Added exports to src/tui/commands/index.ts:
  - executeNoteCommand, handleNoteCommand, addNote, addNoteToCurrentTask, validateNoteInput, getNoteHelp
  - NoteCommandOptions type

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

## 2026-01-18 - impl-050: Implement /priority command handler

### Completed
- Created `src/tui/commands/priority.ts` with full /priority command implementation
- Integrates with PrdManager for updating task priority/phase
- Integrates with TUI store for logging and progress updates

### Features
- **executePriorityCommand(options)**: Main /priority execution function
  - Validates input if provided as raw string
  - Checks for loaded PRD (returns error if none)
  - Validates task exists (returns error if not found)
  - Validates priority is a valid integer
  - Calls PrdManager.updatePriority() which updates phase (implementation_tasks) or priority (userStories)
  - Logs success with old and new values
  - Updates store progress after change

- **handlePriorityCommand(input)**: Convenience for raw /priority command
- **changePriority(taskId, priority, options)**: Programmatic priority change
- **validatePriorityInput(input)**: Pre-validation for UI
  - Validates input without executing
  - Returns parsed args if valid
  - Validates priority is an integer
- **getPriorityHelp()**: Returns help text for the command

### Usage Examples
- `/priority impl-044 1` - Move task to phase 1 (highest priority)
- `/priority US-001 5` - Set user story priority to 5
- `/priority impl-050 2` - Move impl-050 to phase 2

### Technical Details
- Handles exactOptionalPropertyTypes by conditionally building result objects
- Uses parsePriorityArgs() which extracts taskId and priority number
- Lower numbers = higher priority (processed first)
- For implementation_tasks: updates the 'phase' field
- For userStories: updates the 'priority' field
- Changes affect which task is selected next by getNextTask()
- All errors logged to store with "error" level for TUI display

### Updated Exports
- Added exports to src/tui/commands/index.ts:
  - executePriorityCommand, handlePriorityCommand, changePriority, validatePriorityInput, getPriorityHelp
  - PriorityCommandOptions type

### Type check: PASSED
### Tests: 401 passed (114 compatibility + 104 filters + 107 scaffolders + 76 e2e)

